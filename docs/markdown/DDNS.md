# 内网穿透系列

## 内网穿透工具

#### 端口转发+域名型
-   cpolar：https://www.cpolar.com/ 域名每次变，但是能查还好
-   花生壳(贝锐花生壳) https://hsk.oray.com/: 和向日葵远控一家的，在有ip过滤的地方基本已经被封完了。免费有条数限制+流量限制

#### 虚拟局域网
-   ZEROTIER：https://my.zerotier.com/ 在单纯的远控需求下，极佳！可以打通P2P通道，走UDP传输，不经过第三方转发。在打不通的情况下，中心服务器在国外，会很慢。可玩性极高

## 相关知识
TCP/IP系列
路由系列
静态路由表
NAT系列
代理系列

## 流量转发的Windows配置

### 服务端配置

#### 网络共享
最简单的就是用自带：允许其他网络用户通过此计算机的Internet连接，达到NAT的效果。

弊端是NAT的虚拟网卡的ip默认初始化为192.168.137.1 建议在ZEROTIER中设置对应网段以配合。

#### 代理服务器
Clash 本身相当于一个代理服务器，默认7890端口，代理127.0.0.1的流量（本机流量）。 把Allow LAN（允许局域网）勾上，其实就是允许局域网内设备走Clash的代理了，局域网内的设备就可以通过连接代理进行流量转发。

### 客户端设置
如果用ZEROTIER，会默认创建出一个网卡。流量转发的方案有这么几个

#### windows网卡跃点
这个方案，设置比较繁琐，切换比较费劲，不够灵活，适合网络环境稳定的场景

查看ipv4路由表：

 `route print -4`

能看到 网卡信息一列，以及路由表一列

总跃点 = 高级TCP/IP设置中的接口跃点数 + 网卡metric跃点数

tcp/ip跃点数就直接在属性看就行

网卡metric跃点，在自动ip（非指定网关的前提下）使用如下指令：

`route change <网络目标> mask <网络掩码> <网关> metric <metric跃点> if <网卡接口号(网卡信息第一列)>`  
eg:  
`route change 0.0.0.0 mask 0.0.0.0 192.168.8.1 metric 20 if 9`

另一种方法是指定网关，在ipv4高级里面，是有直接指定自定义网关跃点的位置的，设置一个小跃点就行了。

#### 代理
设置-网络和Internet-代理
把代理服务器的ip填上，其他不用改，就行了。切换很简单。
在代理服务器上，只要Clash运行着，其实就跑着一个代理服务器。至于代理到的流量往哪儿走，就是clash的问题了
